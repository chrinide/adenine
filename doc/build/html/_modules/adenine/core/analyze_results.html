<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>adenine.core.analyze_results &mdash; adenine 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/slipGuru.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="adenine 0.1.0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" />
<meta name="keywords"
      content="SlipGuru, 'University of Genoa', statistical learning,
      computational biology, Python, distributed, computing, parallel" />
<map id="logosmap" name="logosmap">
    <area shape="rect" alt="SlipGURU" title="SlipGURU" coords="0,0,89,112"
          href="http://slipguru.disi.unige.it/" />
    <area shape="rect" alt="Dipartimento di Informatica e Scienze dell'Informazione"
          title="Dipartimento di Informatica e Scienze dell'Informazione"
          coords="95,4,200,34" href="http://www.disi.unige.it/" />
    <area shape="rect" alt="Università Degli Studi di Genova"
          title="Università Degli Studi di Genova" coords="124,48,171,107"
          href="http://www.unige.it/" />
</map>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">adenine 0.1.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for adenine.core.analyze_results</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python -W ignore::DeprecationWarning</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">cPickle</span> <span class="kn">as</span> <span class="nn">pkl</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">scipy.cluster.hierarchy</span> <span class="kn">import</span> <span class="n">linkage</span> <span class="k">as</span> <span class="n">sp_linkage</span>

<div class="viewcode-block" id="make_scatter"><a class="viewcode-back" href="../../../index.html#adenine.core.analyze_results.make_scatter">[docs]</a><span class="k">def</span> <span class="nf">make_scatter</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="p">(),</span> <span class="n">embedding</span><span class="o">=</span><span class="p">(),</span> <span class="n">model_param</span><span class="o">=</span><span class="p">(),</span> <span class="n">trueLabel</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate and save the scatter plot of the dimensionality reduced data set.</span>

<span class="sd">    This function generates the scatter plot representing the dimensionality reduced data set. The plots will be saved into the root folder in a tree-like structure.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    root : string</span>
<span class="sd">        The root path for the output creation</span>

<span class="sd">    embedding : array of float, shape : (n_samples, n_dimensions)</span>
<span class="sd">        The low space embedding estimated by the dimensinality reduction and manifold learning algorithm.</span>

<span class="sd">    model_param : dictionary</span>
<span class="sd">        The parameters of the dimensionality reduciont and manifold learning algorithm.</span>

<span class="sd">    trueLabel : array of float, shape : n_samples</span>
<span class="sd">        The true label vector; np.nan if missing (useful for plotting reasons).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_samples</span><span class="p">,</span> <span class="n">n_dim</span> <span class="o">=</span> <span class="n">embedding</span><span class="o">.</span><span class="n">shape</span>

    <span class="c"># print trueLabel</span>
    <span class="c"># raise ValueError(&#39;DEBUG&#39;)</span>

    <span class="c"># Define plot color</span>
<span class="c">#    if not np.isnan(trueLabel[0]):</span>
    <span class="k">if</span> <span class="n">trueLabel</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">trueLabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_samples</span><span class="p">))</span>
        <span class="n">_hue</span> <span class="o">=</span> <span class="s">&#39; &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">trueLabel</span> <span class="c"># use the labels if provided</span>
        <span class="n">_hue</span> <span class="o">=</span> <span class="s">&#39;Classes&#39;</span>

    <span class="c"># Define the fileName</span>
    <span class="n">fileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="c"># Define the plot title</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)):</span> <span class="c"># something like [&#39;results&#39;, &#39;ade_debug_&#39;, &#39;Standardize&#39;, &#39;PCA&#39;]</span>
        <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;_ade&#39;</span><span class="p">:</span> <span class="k">break</span>
    <span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s">&quot;$\mapsto$&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>

    <span class="c"># Create pandas data frame (needed by sns)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">embedding</span><span class="p">[:,:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;$x_1$&quot;</span><span class="p">,</span><span class="s">&quot;$x_2$&quot;</span><span class="p">,</span><span class="n">_hue</span><span class="p">])</span>
    <span class="c"># Generate seaborn plot</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">_hue</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s">&quot;Set1&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">legend_out</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">,</span> <span class="s">&quot;$x_1$&quot;</span><span class="p">,</span> <span class="s">&quot;$x_2$&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_hue</span> <span class="o">!=</span> <span class="s">&#39; &#39;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span> <span class="c">#!! customize legend</span>
    <span class="c"># g.set_xticklabels([])</span>
    <span class="c"># g.set_yticklabels([])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">fileName</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Figured saved {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">fileName</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="make_voronoi"><a class="viewcode-back" href="../../../index.html#adenine.core.analyze_results.make_voronoi">[docs]</a><span class="k">def</span> <span class="nf">make_voronoi</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="p">(),</span> <span class="n">data_in</span><span class="o">=</span><span class="p">(),</span> <span class="n">model_param</span><span class="o">=</span><span class="p">(),</span> <span class="n">trueLabel</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">(),</span> <span class="n">model</span><span class="o">=</span><span class="p">()):</span>
    <span class="sd">&quot;&quot;&quot;Generate and save the Voronoi tessellation obtained from the clustering algorithm.</span>

<span class="sd">    This function generates the Voronoi tessellation obtained from the clustering algorithm applied on the data projected on a two-dimensional embedding. The plots will be saved into the appropriate folder of the tree-like structure created into the root folder.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    root : string</span>
<span class="sd">        The root path for the output creation</span>

<span class="sd">    data_in : array of float, shape : (n_samples, n_dimensions)</span>
<span class="sd">        The low space embedding estimated by the dimensinality reduction and manifold learning algorithm.</span>

<span class="sd">    model_param : dictionary</span>
<span class="sd">        The parameters of the dimensionality reduciont and manifold learning algorithm.</span>

<span class="sd">    trueLabel : array of float, shape : n_samples</span>
<span class="sd">        The true label vector; np.nan if missing (useful for plotting reasons).</span>

<span class="sd">    labels : array of int, shape : n_samples</span>
<span class="sd">        The result of the clustering step.</span>

<span class="sd">    model : sklearn or sklearn-like object</span>
<span class="sd">        An instance of the class that evaluates a step. In particular this must be a clustering model provided with the clusters_centers_ attribute (e.g. KMeans).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_samples</span><span class="p">,</span> <span class="n">n_dim</span> <span class="o">=</span> <span class="n">data_in</span><span class="o">.</span><span class="n">shape</span>

    <span class="c"># Define plot color</span>
    <span class="c">#if not np.isnan(trueLabel[0]):</span>

    <span class="k">if</span> <span class="n">trueLabel</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">trueLabel</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_samples</span><span class="p">))</span>
        <span class="n">_hue</span> <span class="o">=</span> <span class="s">&#39; &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">trueLabel</span> <span class="c"># use the labels if provided</span>
        <span class="n">_hue</span> <span class="o">=</span> <span class="s">&#39;Classes&#39;</span>

    <span class="c"># Define the fileName</span>
    <span class="n">fileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="c"># Define the plot title</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)):</span> <span class="c"># something like [&#39;results&#39;, &#39;ade_debug_&#39;, &#39;Standardize&#39;, &#39;PCA&#39;]</span>
        <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;_ade&#39;</span><span class="p">:</span> <span class="k">break</span>
    <span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s">&quot;$\mapsto$&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>

    <span class="c"># Seaborn scatter Plot</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">data_in</span><span class="p">[:,:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;$x_1$&quot;</span><span class="p">,</span><span class="s">&quot;$x_2$&quot;</span><span class="p">,</span><span class="n">_hue</span><span class="p">])</span>
    <span class="c"># Generate seaborn plot</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">_hue</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s">&quot;Set1&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">legend_out</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">,</span> <span class="s">&quot;$x_1$&quot;</span><span class="p">,</span> <span class="s">&quot;$x_2$&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_hue</span> <span class="o">!=</span> <span class="s">&#39; &#39;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span> <span class="c">#!! customize legend</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="c"># Add centroids</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s">&#39;cluster_centers_&#39;</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;h&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">)</span>

    <span class="c"># Make and add to the Plot the decision boundary.</span>
    <span class="n">npoints</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c"># the number of points in that makes the background. Reducing this will decrease the quality of the voronoi background</span>
    <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="mf">5.</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">/</span> <span class="mf">5.</span> <span class="c"># zoom out the plot a bit</span>
    <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="o">-</span><span class="n">offset</span><span class="p">,</span> <span class="n">x_max</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">npoints</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_min</span><span class="o">-</span><span class="n">offset</span><span class="p">,</span> <span class="n">y_max</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">npoints</span><span class="p">))</span>

    <span class="c"># Obtain labels for each point in mesh. Use last trained model.</span>

    <span class="n">Z</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span>
    <span class="c"># Put the result into a color plot</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span>
               <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xx</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">yy</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">yy</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">&#39;Pastel1&#39;</span><span class="p">),</span> <span class="n">aspect</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">xx</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xx</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">yy</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">yy</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>

    <span class="n">fileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">fileName</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Figured saved {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">fileName</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="est_clst_perf"><a class="viewcode-back" href="../../../index.html#adenine.core.analyze_results.est_clst_perf">[docs]</a><span class="k">def</span> <span class="nf">est_clst_perf</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="p">(),</span> <span class="n">data_in</span><span class="o">=</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="p">(),</span> <span class="n">trueLabel</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">(),</span> <span class="n">metric</span><span class="o">=</span><span class="s">&#39;euclidean&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Estimate the clustering performance.</span>

<span class="sd">    This function estimate the clustering performance by means of several indexes. Then eventually saves the results in a tree-like structure in the root folder.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    root : string</span>
<span class="sd">        The root path for the output creation</span>

<span class="sd">    data_in : array of float, shape : (n_samples, n_dimensions)</span>
<span class="sd">        The low space embedding estimated by the dimensinality reduction and manifold learning algorithm.</span>

<span class="sd">    label : array of float, shape : n_samples</span>
<span class="sd">        The label assignment performed by the clusterin algorithm.</span>

<span class="sd">    trueLabel : array of float, shape : n_samples</span>
<span class="sd">        The true label vector; np.nan if missing.</span>

<span class="sd">    model : sklearn or sklearn-like object</span>
<span class="sd">        An instance of the class that evaluates a step. In particular this must be a clustering model provided with the clusters_centers_ attribute (e.g. KMeans).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">perf_out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">perf_out</span><span class="p">[</span><span class="s">&#39;silhouette&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">silhouette_score</span><span class="p">(</span><span class="n">data_in</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s">&#39;inertia_&#39;</span><span class="p">):</span> <span class="c"># Sum of distances of samples to their closest cluster center.</span>
            <span class="n">perf_out</span><span class="p">[</span><span class="s">&#39;inertia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdl_obj</span><span class="o">.</span><span class="n">inertia_</span>

        <span class="c">#if not np.isnan(np.array([trueLabel]).any()): # the next indexes need a gold standard</span>
        <span class="c"># if not np.array([trueLabel]).any() == np.nan: # the next indexes need a gold standard</span>
        <span class="k">if</span> <span class="n">trueLabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">trueLabel</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span> <span class="c"># the next indexes need a gold standard</span>
            <span class="n">perf_out</span><span class="p">[</span><span class="s">&#39;ari&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">adjusted_rand_score</span><span class="p">(</span><span class="n">trueLabel</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
            <span class="n">perf_out</span><span class="p">[</span><span class="s">&#39;ami&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">adjusted_mutual_info_score</span><span class="p">(</span><span class="n">trueLabel</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
            <span class="n">perf_out</span><span class="p">[</span><span class="s">&#39;homogeneity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">homogeneity_score</span><span class="p">(</span><span class="n">trueLabel</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
            <span class="n">perf_out</span><span class="p">[</span><span class="s">&#39;completeness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">completeness_score</span><span class="p">(</span><span class="n">trueLabel</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
            <span class="n">perf_out</span><span class="p">[</span><span class="s">&#39;v_measure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">v_measure_score</span><span class="p">(</span><span class="n">trueLabel</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Clustering performance evaluation failed for {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
        <span class="n">perf_out</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;empty&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>

    <span class="c"># Define the fileName</span>
    <span class="n">fileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">fileName</span><span class="o">+</span><span class="s">&quot;.txt&quot;</span><span class="p">),</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;------------------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Adenine: Clustering Performance</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;------------------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Index Name{}|{}Index Score</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;------------------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">perf_out</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{}{}|{}{:.3}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">20</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)),</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span><span class="n">perf_out</span><span class="p">[</span><span class="n">elem</span><span class="p">]))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;------------------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

    <span class="c"># pkl Dump</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">fileName</span><span class="o">+</span><span class="s">&#39;.pkl&#39;</span><span class="p">),</span> <span class="s">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pkl</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">perf_out</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Dumped : {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">fileName</span><span class="o">+</span><span class="s">&#39;.pkl&#39;</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="get_step_attributes"><a class="viewcode-back" href="../../../index.html#adenine.core.analyze_results.get_step_attributes">[docs]</a><span class="k">def</span> <span class="nf">get_step_attributes</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="p">(),</span> <span class="n">pos</span><span class="o">=</span><span class="p">()):</span>
    <span class="sd">&quot;&quot;&quot;Get the attributes of the input step.</span>

<span class="sd">    This function returns the attributes (i.e. level, name, outcome) of the input step. This comes handy when dealing with steps with more than one parameter (e.g. KernelPCA &#39;poly&#39; or &#39;rbf&#39;).</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    step : list</span>
<span class="sd">        A step coded by ade_run.py as [name, level, results, parameters]</span>

<span class="sd">    pos : int</span>
<span class="sd">        The position of the step inside the pipeline.</span>

<span class="sd">    Returns</span>
<span class="sd">    -----------</span>
<span class="sd">    name : string</span>
<span class="sd">        A unique name for the step (e.g. KernelPCA_rbf).</span>

<span class="sd">    level : {imputing, preproc, dimred, clustering}</span>
<span class="sd">        The step level.</span>

<span class="sd">    data_out : array of float, shape : (n_samples, n_out)</span>
<span class="sd">        Where n_out is n_dimensions for dimensionality reduction step, or 1 for clustering.</span>

<span class="sd">    data_in : array of float, shape : (n_samples, n_in)</span>
<span class="sd">        Where n_in is n_dimensions for preprocessing/imputing/dimensionality reduction step, or n_dim for clustering (because the data have already been dimensionality reduced).</span>

<span class="sd">    param : dictionary</span>
<span class="sd">        The parameters of the sklearn object implementing the algorithm.</span>

<span class="sd">    mdl_obj : sklearn or sklearn-like object</span>
<span class="sd">        This is an instance of the class that evaluates a step.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">step</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">step</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c"># {imputing, preproc, dimred, clustering}</span>
    <span class="n">param</span> <span class="o">=</span> <span class="n">step</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">data_out</span> <span class="o">=</span> <span class="n">step</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">data_in</span> <span class="o">=</span> <span class="n">step</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">mdl_obj</span> <span class="o">=</span> <span class="n">step</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">voronoi_mdl_obj</span> <span class="o">=</span> <span class="n">step</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">level</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;none&#39;</span> <span class="ow">and</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">level</span> <span class="o">=</span> <span class="s">&#39;preproc&#39;</span>
    <span class="k">if</span> <span class="n">level</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;none&#39;</span> <span class="ow">and</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">level</span> <span class="o">=</span> <span class="s">&#39;dimred&#39;</span>
    <span class="n">metric</span> <span class="o">=</span> <span class="s">&#39;euclidean&#39;</span>

    <span class="c"># Append additional parameters in the step name</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;KernelPCA&#39;</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="s">&#39;_&#39;</span><span class="o">+</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;kernel&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;LLE&#39;</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="s">&#39;_&#39;</span><span class="o">+</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;method&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;MDS&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s">&#39;metric&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;True&#39;</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="s">&#39;_metric&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="s">&#39;_nonmetric&#39;</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;Hierarchical&#39;</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="s">&#39;_&#39;</span><span class="o">+</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;affinity&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;linkage&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s">&#39;affinity&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;precomputed&#39;</span><span class="p">:</span>
            <span class="n">metric</span> <span class="o">=</span> <span class="s">&#39;precomputed&#39;</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;{} : {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">level</span><span class="p">,</span><span class="n">name</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">data_out</span><span class="p">,</span> <span class="n">data_in</span><span class="p">,</span> <span class="n">mdl_obj</span><span class="p">,</span> <span class="n">voronoi_mdl_obj</span><span class="p">,</span> <span class="n">metric</span>
</div>
<div class="viewcode-block" id="make_tree"><a class="viewcode-back" href="../../../index.html#adenine.core.analyze_results.make_tree">[docs]</a><span class="k">def</span> <span class="nf">make_tree</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="p">(),</span> <span class="n">data_in</span><span class="o">=</span><span class="p">(),</span> <span class="n">model_param</span><span class="o">=</span><span class="p">(),</span> <span class="n">trueLabel</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">(),</span> <span class="n">model</span><span class="o">=</span><span class="p">()):</span>
    <span class="sd">&quot;&quot;&quot;Generate and save the tree structure obtained from the clustering algorithm.</span>

<span class="sd">    This function generates the tree obtained from the clustering algorithm applied on the data. The plots will be saved into the appropriate folder of the tree-like structure created into the root folder.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    root : string</span>
<span class="sd">        The root path for the output creation</span>

<span class="sd">    data_in : array of float, shape : (n_samples, n_dimensions)</span>
<span class="sd">        The low space embedding estimated by the dimensinality reduction and manifold learning algorithm.</span>

<span class="sd">    model_param : dictionary</span>
<span class="sd">        The parameters of the dimensionality reduciont and manifold learning algorithm.</span>

<span class="sd">    trueLabel : array of float, shape : n_samples</span>
<span class="sd">        The true label vector; np.nan if missing (useful for plotting reasons).</span>

<span class="sd">    labels : array of int, shape : n_samples</span>
<span class="sd">        The result of the clustering step.</span>

<span class="sd">    model : sklearn or sklearn-like object</span>
<span class="sd">        An instance of the class that evaluates a step. In particular this must be a clustering model provided with the clusters_centers_ attribute (e.g. KMeans).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">itertools</span>
    <span class="kn">import</span> <span class="nn">pydot</span>

    <span class="n">MAX_NODES</span> <span class="o">=</span> <span class="mi">150</span>

    <span class="n">graph</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">graph_type</span><span class="o">=</span><span class="s">&#39;graph&#39;</span><span class="p">)</span>

    <span class="n">ii</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">data_in</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">children_</span><span class="p">):</span>
        <span class="n">root_node</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span>
        <span class="n">left_edge</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">root_node</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">right_edge</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">root_node</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">right_edge</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">left_edge</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">MAX_NODES</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="c"># Define the filename</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;_tree.png&#39;</span><span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Figured saved {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="make_dendrogram"><a class="viewcode-back" href="../../../index.html#adenine.core.analyze_results.make_dendrogram">[docs]</a><span class="k">def</span> <span class="nf">make_dendrogram</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="p">(),</span> <span class="n">data_in</span><span class="o">=</span><span class="p">(),</span> <span class="n">model_param</span><span class="o">=</span><span class="p">(),</span> <span class="n">trueLabel</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">(),</span> <span class="n">model</span><span class="o">=</span><span class="p">()):</span>
    <span class="sd">&quot;&quot;&quot;Generate and save the dendrogram obtained from the clustering algorithm.</span>

<span class="sd">    This function generates the dendrogram obtained from the clustering algorithm applied on the data. The plots will be saved into the appropriate folder of the tree-like structure created into the root folder.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    root : string</span>
<span class="sd">        The root path for the output creation</span>

<span class="sd">    data_in : array of float, shape : (n_samples, n_dimensions)</span>
<span class="sd">        The low space embedding estimated by the dimensinality reduction and manifold learning algorithm.</span>

<span class="sd">    model_param : dictionary</span>
<span class="sd">        The parameters of the dimensionality reduciont and manifold learning algorithm.</span>

<span class="sd">    trueLabel : array of float, shape : n_samples</span>
<span class="sd">        The true label vector; np.nan if missing (useful for plotting reasons).</span>

<span class="sd">    labels : array of int, shape : n_samples</span>
<span class="sd">        The result of the clustering step.</span>

<span class="sd">    model : sklearn or sklearn-like object</span>
<span class="sd">        An instance of the class that evaluates a step. In particular this must be a clustering model provided with the clusters_centers_ attribute (e.g. KMeans).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># tmp = np.hstack((np.arange(0,data_in.shape[0],1)[:,np.newaxis], data_in[:,0][:,np.newaxis], data_in[:,1][:,np.newaxis]))</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">data_in</span>
    <span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;$x_{&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;}$&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_in</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tmp</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">affinity</span> <span class="o">==</span> <span class="s">&#39;precomputed&#39;</span><span class="p">:</span> <span class="c"># TODO sistemare, fede</span>
        <span class="c"># tmp is the distance matrix</span>
        <span class="n">make_dendrograms</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">make_dendrograms</span><span class="p">:</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="s">&quot;monospace&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;single&#39;</span><span class="p">,</span><span class="s">&#39;complete&#39;</span><span class="p">,</span><span class="s">&#39;average&#39;</span><span class="p">,</span><span class="s">&#39;weighted&#39;</span><span class="p">,</span><span class="s">&#39;centroid&#39;</span><span class="p">,</span><span class="s">&#39;median&#39;</span><span class="p">,</span><span class="s">&#39;ward&#39;</span><span class="p">]:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Compute linkage matrix with metric={} ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="p">))</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">sp_linkage</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s">&#39;euclidean&#39;</span><span class="p">)</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">clustermap</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">row_linkage</span><span class="o">=</span><span class="n">Z</span><span class="p">,</span> <span class="n">col_linkage</span><span class="o">=</span><span class="n">Z</span><span class="p">)</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="n">method</span><span class="o">+</span><span class="s">&#39;_dendrogram.png&#39;</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Figured saved {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">plotting.silhouette_score_plot</span> <span class="kn">import</span> <span class="n">plot_avg_silhouette</span>
                <span class="n">plot_avg_silhouette</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Cannot import name {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;plotting&#39;</span><span class="p">))</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">clustermap</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">method</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">linkage</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">affinity</span><span class="p">)</span>

    <span class="c"># Define the fileName</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;_dendrogram.png&#39;</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Figured saved {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="make_scatterplot"><a class="viewcode-back" href="../../../index.html#adenine.core.analyze_results.make_scatterplot">[docs]</a><span class="k">def</span> <span class="nf">make_scatterplot</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="p">(),</span> <span class="n">data_in</span><span class="o">=</span><span class="p">(),</span> <span class="n">model_param</span><span class="o">=</span><span class="p">(),</span> <span class="n">trueLabel</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">(),</span> <span class="n">model</span><span class="o">=</span><span class="p">(),</span> <span class="n">n_dimensions</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate and save the scatter plot obtained from the clustering algorithm.</span>

<span class="sd">    This function generates the scatter plot obtained from the clustering algorithm applied on the data projected on a two-dimensional embedding. The color of the points in the plot is consistent with the label estimated by the algorithm. The plots will be saved into the appropriate folder of the tree-like structure created into the root folder.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    root : string</span>
<span class="sd">        The root path for the output creation</span>

<span class="sd">    data_in : array of float, shape : (n_samples, n_dimensions)</span>
<span class="sd">        The low space embedding estimated by the dimensinality reduction and manifold learning algorithm.</span>

<span class="sd">    model_param : dictionary</span>
<span class="sd">        The parameters of the dimensionality reduciont and manifold learning algorithm.</span>

<span class="sd">    trueLabel : array of float, shape : n_samples</span>
<span class="sd">        The true label vector; np.nan if missing (useful for plotting reasons).</span>

<span class="sd">    labels : array of int, shape : n_samples</span>
<span class="sd">        The result of the clustering step.</span>

<span class="sd">    model : sklearn or sklearn-like object</span>
<span class="sd">        An instance of the class that evaluates a step. In particular this must be a clustering model provided with the clusters_centers_ attribute (e.g. KMeans).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_samples</span><span class="p">,</span> <span class="n">n_dim</span> <span class="o">=</span> <span class="n">data_in</span><span class="o">.</span><span class="n">shape</span>

    <span class="c"># Define plot color</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">labels</span>
    <span class="n">_hue</span> <span class="o">=</span> <span class="s">&#39;Estimated Labels&#39;</span>

    <span class="c"># Define the fileName</span>
    <span class="n">fileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="c"># Define the plot title</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)):</span> <span class="c"># something like [&#39;results&#39;, &#39;ade_debug_&#39;, &#39;Standardize&#39;, &#39;PCA&#39;]</span>
        <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;_ade&#39;</span><span class="p">:</span> <span class="k">break</span>
    <span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s">&quot;$\mapsto$&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>

    <span class="c"># Seaborn scatter Plot</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">data_in</span><span class="p">[:,:</span><span class="n">n_dimensions</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">n_dimensions</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;$x_1$&quot;</span><span class="p">,</span><span class="s">&quot;$x_2$&quot;</span><span class="p">,</span><span class="n">_hue</span><span class="p">])</span>
        <span class="c"># Generate seaborn plot</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">_hue</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s">&quot;Set1&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">legend_out</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">,</span> <span class="s">&quot;$x_1$&quot;</span><span class="p">,</span> <span class="s">&quot;$x_2$&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_hue</span> <span class="o">!=</span> <span class="s">&#39; &#39;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span> <span class="c">#!! customize legend</span>
    <span class="k">elif</span> <span class="n">n_dimensions</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s">&#39;3d&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">X</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s">&#39;hot&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="n">fileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">fileName</span><span class="o">+</span><span class="s">&quot;_scatter&quot;</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Figured saved {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">fileName</span><span class="o">+</span><span class="s">&quot;_scatter&quot;</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="start"><a class="viewcode-back" href="../../../index.html#adenine.core.analyze_results.start">[docs]</a><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">inputDict</span><span class="o">=</span><span class="p">(),</span> <span class="n">rootFolder</span><span class="o">=</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">feat_names</span><span class="o">=</span><span class="p">(),</span> <span class="n">class_names</span><span class="o">=</span><span class="p">()):</span>
    <span class="sd">&quot;&quot;&quot;Analyze the results of ade_run.</span>

<span class="sd">    This function analyze the dictionary generated by ade_run, generates the plots, and saves them in a tree-like folder structure in rootFolder.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    inputDict : dictionary</span>
<span class="sd">        The dictionary created by ade_run.py on some data.</span>

<span class="sd">    rootFolder : string</span>
<span class="sd">        The root path for the output creation</span>

<span class="sd">    y : array of float, shape : n_samples</span>
<span class="sd">        The label vector; np.nan if missing.</span>

<span class="sd">    feature_names : array of integers (or strings), shape : n_features</span>
<span class="sd">        The feature names; a range of numbers if missing.</span>

<span class="sd">    class_names : array of integers (or strings), shape : n_features</span>
<span class="sd">        The class names; a range of numbers if missing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">pipe</span> <span class="ow">in</span> <span class="n">inputDict</span><span class="p">:</span> <span class="c"># iterating over a dictionary gives you the keys</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Analizing {} ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipe</span><span class="p">))</span>
        <span class="n">outFolder</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="c"># where the results will be placed</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;------</span><span class="se">\n</span><span class="s">{} : </span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipe</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">inputDict</span><span class="p">[</span><span class="n">pipe</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>

            <span class="c"># Tree-like folder structure definition</span>
            <span class="n">step_name</span><span class="p">,</span> <span class="n">step_level</span><span class="p">,</span> <span class="n">step_param</span><span class="p">,</span> <span class="n">step_out</span><span class="p">,</span> <span class="n">step_in</span><span class="p">,</span> <span class="n">mdl_obj</span><span class="p">,</span> <span class="n">voronoi_mdl_obj</span><span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="n">get_step_attributes</span><span class="p">(</span><span class="n">inputDict</span><span class="p">[</span><span class="n">pipe</span><span class="p">][</span><span class="n">step</span><span class="p">],</span> <span class="n">pos</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>


            <span class="c"># Output folder definition &amp; creation</span>
            <span class="n">outFolder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outFolder</span><span class="p">,</span><span class="n">step_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootFolder</span><span class="p">,</span> <span class="n">outFolder</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootFolder</span><span class="p">,</span> <span class="n">outFolder</span><span class="p">))</span>

            <span class="c"># Launch analysis</span>
            <span class="k">if</span> <span class="n">step_level</span> <span class="o">==</span> <span class="s">&#39;dimred&#39;</span><span class="p">:</span>
                <span class="n">make_scatter</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootFolder</span><span class="p">,</span> <span class="n">outFolder</span><span class="p">),</span> <span class="n">embedding</span><span class="o">=</span><span class="n">step_out</span><span class="p">,</span> <span class="n">trueLabel</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">model_param</span><span class="o">=</span><span class="n">step_param</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">step_level</span> <span class="o">==</span> <span class="s">&#39;clustering&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mdl_obj</span><span class="p">,</span> <span class="s">&#39;cluster_centers_&#39;</span><span class="p">):</span>
                    <span class="n">make_voronoi</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootFolder</span><span class="p">,</span> <span class="n">outFolder</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="n">step_out</span><span class="p">,</span> <span class="n">trueLabel</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">model_param</span><span class="o">=</span><span class="n">step_param</span><span class="p">,</span> <span class="n">data_in</span><span class="o">=</span><span class="n">step_in</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">voronoi_mdl_obj</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mdl_obj</span><span class="p">,</span> <span class="s">&#39;n_leaves_&#39;</span><span class="p">):</span>
                    <span class="n">make_tree</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootFolder</span><span class="p">,</span> <span class="n">outFolder</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="n">step_out</span><span class="p">,</span> <span class="n">trueLabel</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">model_param</span><span class="o">=</span><span class="n">step_param</span><span class="p">,</span> <span class="n">data_in</span><span class="o">=</span><span class="n">step_in</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">mdl_obj</span><span class="p">)</span>

                    <span class="n">make_dendrogram</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootFolder</span><span class="p">,</span> <span class="n">outFolder</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="n">step_out</span><span class="p">,</span> <span class="n">trueLabel</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">model_param</span><span class="o">=</span><span class="n">step_param</span><span class="p">,</span> <span class="n">data_in</span><span class="o">=</span><span class="n">step_in</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">mdl_obj</span><span class="p">)</span>

                <span class="n">make_scatterplot</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootFolder</span><span class="p">,</span> <span class="n">outFolder</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="n">step_out</span><span class="p">,</span> <span class="n">trueLabel</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">model_param</span><span class="o">=</span><span class="n">step_param</span><span class="p">,</span> <span class="n">data_in</span><span class="o">=</span><span class="n">step_in</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">mdl_obj</span><span class="p">)</span>

                <span class="n">est_clst_perf</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootFolder</span><span class="p">,</span> <span class="n">outFolder</span><span class="p">),</span> <span class="n">data_in</span><span class="o">=</span><span class="n">step_in</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">step_out</span><span class="p">,</span> <span class="n">trueLabel</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
   
      <h3>Download</h3>
      <p>Current version: <b>0.1.0</b></p>
      <p>Get adenine from the
         <a href="http://pypi.python.org/pypi/adenine">Python Package Index</a>,
         or install it with:
      </p>
      <pre>pip install --upgrade adenine</pre>
      <!--or:-->
      <!--<pre>easy_install -U adenine</pre>-->
      <p>Latest
         <a href="https://bitbucket.org/slipguru/adenine/downloads/adenine.pdf">
            documentation in pdf
         </a>
         is also available.
      </p>
   

   
   

    
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
    <p class="logo">
       <img class="logo" src="../../../_static/logos.png" alt="Logos" usemap="#logosmap" />
    </p>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">adenine 0.1.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Samuele Fiorini.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>